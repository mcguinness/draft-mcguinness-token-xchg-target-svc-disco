



Network Working Group                                      K. McGuinness
Internet-Draft                                               Independent
Intended status: Standards Track                              A. Parecki
Expires: 15 June 2026                                               Okta
                                                        12 December 2025


           OAuth 2.0 Token Exchange Target Service Discovery
    draft-mcguinness-token-exchange-target-service-discovery-latest

Abstract

   This specification defines a method for OAuth 2.0 clients to discover
   the set of available target services (audiences, resources, and
   scopes) for a given subject token when performing OAuth 2.0 Token
   Exchange.  The discovery endpoint accepts any subject token type
   registered in the OAuth Token Type Registry and returns values that
   are valid inputs to subsequent Token Exchange requests, supporting
   advanced use cases such as identity chaining and cross-domain
   delegation.

About This Document

   This note is to be removed before publishing as an RFC.

   The latest revision of this draft can be found at
   https://mcguinness.github.io/draft-mcguinness-token-exchange-target-
   service-discovery/draft-mcguinness-token-exchange-target-service-
   discovery.html.  Status information for this document may be found at
   https://datatracker.ietf.org/doc/draft-mcguinness-token-exchange-
   target-service-discovery/.

   Source for this draft and an issue tracker can be found at
   https://github.com/mcguinness/draft-mcguinness-token-exchange-target-
   service-discovery.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on 15 June 2026.

Copyright Notice

   Copyright (c) 2025 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents (https://trustee.ietf.org/
   license-info) in effect on the date of publication of this document.
   Please review these documents carefully, as they describe your rights
   and restrictions with respect to this document.  Code Components
   extracted from this document must include Revised BSD License text as
   described in Section 4.e of the Trust Legal Provisions and are
   provided without warranty as described in the Revised BSD License.

Table of Contents

   1.  Introduction
   2.  Conventions and Definitions
   3.  Token Exchange Target Service Discovery Endpoint
     3.1.  Endpoint Request
       3.1.1.  Request Parameters
       3.1.2.  Request Example
     3.2.  Endpoint Response
       3.2.1.  Successful Response
       3.2.2.  Response Example
     3.3.  Error Response
       3.3.1.  Error Response Example
   4.  Example
     4.1.  Step 1: Discover Target Services
       4.1.1.  Discovery Request
       4.1.2.  Discovery Response
     4.2.  Step 2: Discover Token Types (Optional)
       4.2.1.  Metadata Request
       4.2.2.  Metadata Response
     4.3.  Step 3: Perform Token Exchange
       4.3.1.  Token Exchange Request
       4.3.2.  Token Exchange Response
   5.  Authorization Server Metadata
   6.  Security Considerations
     6.1.  Subject Token Validation
     6.2.  Client Authentication
     6.3.  Authorization Policy Enforcement
     6.4.  Information Disclosure
     6.5.  Token Confidentiality
     6.6.  Error Handling
   7.  Privacy Considerations
   8.  IANA Considerations
     8.1.  OAuth Authorization Server Metadata Registry
   9.  Normative References
   Acknowledgments
   Authors' Addresses

1.  Introduction

   OAuth 2.0 Token Exchange [RFC8693] enables a client to present a
   token issued in one security domain to an Authorization Server and
   securely trade it for a new token issued for another domain.  The
   exchanged token is minted with the target serverâ€™s token
   requirements, including its own audience, resource indicators, and
   scopes, so it becomes valid and enforceable for the desired
   downstream service.  This enables controlled cross-domain access,
   removes the confused-deputy problem by ensuring tokens are explicitly
   targeted to the correct service, and avoids requiring direct trust
   between the original token issuer and the target service.

   Authorization Servers may be capable of issuing tokens to multiple
   services for a given subject token and client, but the client must
   already know which values it may request.  Today, this knowledge is
   typically provided through static configuration, proprietary APIs, or
   informal documentation, leading to brittle integrations and
   unnecessary Token Exchange failures, particularly when subjects are
   authorized to access only a subset of available services.

   This specification defines the OAuth 2.0 Token Exchange Target
   Service Discovery Endpoint, a standardized mechanism that enables
   clients to dynamically discover the set of available Token Exchange
   targets (audiences, resources, and scopes) for a given subject token.
   The authorization server evaluates both the subject token and the
   client's permissions and returns only the values the client is
   authorized to request.

   This extension is especially valuable in identity chaining and cross-
   domain authorization scenarios, such as:

   *  Multi-tier microservices architectures where tokens must be
      progressively exchanged with narrower permissions.

   *  Cross-organizational and federated systems where downstream
      services exist in separate administrative domains.

   *  Cross-cloud or hybrid deployments requiring strict control over
      which domains may issue or accept exchanged tokens.

   *  Delegated flows where derived tokens represent constrained or
      transformed identities across trust boundaries.

   This specification provides several benefits:

   *  Eliminates the need for static configuration by allowing clients
      to dynamically discover available target services

   *  Reduces Token Exchange failures by enabling clients to learn valid
      targets before attempting a Token Exchange request

   *  Supports identity chaining by allowing the authorization server to
      provide the next allowable "hop" in a derived-identity chain

   *  Enhances cross-domain trust by preventing clients from requesting
      tokens for unauthorized or untrusted domains

   *  Improves interoperability by standardizing previously proprietary
      discovery mechanisms

   *  Improves developer and operator experience by enabling tools to
      automatically enumerate valid downstream targets

   *  Supports dynamic authorization by reflecting real-time policy
      evaluation, client permissions, and subject token context

2.  Conventions and Definitions

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in
   BCP 14 [RFC2119] [RFC8174] when, and only when, they appear in all
   capitals, as shown here.

3.  Token Exchange Target Service Discovery Endpoint

   This specification defines a new endpoint for OAuth 2.0 Authorization
   Servers that enables clients to discover the set of available target
   services (audiences, resources, and scopes) for a given subject token
   when performing OAuth 2.0 Token Exchange [RFC8693].

   The endpoint is identified by the Authorization Server metadata
   parameter token_exchange_target_service_discovery_endpoint, as
   defined in Section 7.

3.1.  Endpoint Request

   The client makes a request to the token exchange target service
   discovery endpoint by sending an HTTP POST request to the endpoint
   URL.  The client MUST use TLS as specified in Section 1.6 of
   [RFC6749].

   The endpoint URL MUST be obtained from the Authorization Server's
   metadata document [RFC8414] using the
   token_exchange_target_service_discovery_endpoint parameter.  The
   endpoint URL is an absolute URL as defined by [RFC3986].

   The client sends the parameters using the application/x-www-form-
   urlencoded format per Appendix B of [RFC6749].

3.1.1.  Request Parameters

   The following parameters are used in the request:

   subject_token  REQUIRED.  The subject token used as input to
      discovery.  The token type is indicated by the subject_token_type
      parameter.

   subject_token_type  REQUIRED.  An identifier, as described in
      Section 5 of [RFC8693], that indicates the type of the
      subject_token parameter.  This identifier MUST be registered in
      the "OAuth Token Type Registry" as defined in Section 5.1 of
      [RFC8693].

   The client MAY include additional parameters as defined by the OAuth
   2.0 specification or extensions.  Client authentication MAY be
   required by the authorization server.  The means of client
   authentication are defined by the authorization server and MAY
   include any method supported by the authorization server, including
   those defined in Section 2.3 of [RFC6749].

3.1.2.  Request Example

   The following is an example of a discovery request:

   POST /target-discovery HTTP/1.1
   Host: as.example.com
   Content-Type: application/x-www-form-urlencoded

   subject_token=SlAV32hkKG...ACCESSTOKEN...
   &subject_token_type=urn:ietf:params:oauth:token-type:access_token

3.2.  Endpoint Response

   The authorization server validates the request and returns a response
   with the discovery results.  The response MUST use the application/
   json media type as specified in [RFC7159].  The Content-Type header
   of the response MUST be set to application/json.

3.2.1.  Successful Response

   If the request is valid and authorized, the authorization server
   returns a JSON array of available token exchange targets.  Each
   element in the array represents a target service that the client is
   authorized to request in a subsequent token exchange operation.

   Each target service object contains the following fields:

   audience  OPTIONAL.  A string indicating an available audience value
      for token exchange, as defined in Section 2.1 of [RFC8693].

   resource  OPTIONAL.  A string or array of strings indicating
      available resource indicator values, as defined in [RFC8707].

   At least one of audience or resource MUST be present in each target
   service object.  A target service object MAY specify both audience
   and resource.

   scope  OPTIONAL.  A space-delimited list of OAuth 2.0 scope values,
      as defined in Section 3.3 of [RFC6749], that are available for
      this target service.

   supported_token_types  OPTIONAL.  An array of strings indicating the
      token types that may be requested for this target service in a
      subsequent token exchange operation.  Each string MUST be a
      registered token type identifier from the "OAuth Token Type
      Registry" as defined in Section 5.1 of [RFC8693].  If omitted, the
      client may use any token type supported by the authorization
      server.

   If no target services are available for the given subject token and
   client, the authorization server returns an empty array [].

3.2.2.  Response Example

   The following is an example of a successful discovery response:

HTTP/1.1 200 OK
Content-Type: application/json

[
  {
    "audience": "https://api.example.com",
    "resource": ["https://api.example.com/orders", "https://api.example.com/inventory"],
    "scope": "orders.read inventory.read",
    "supported_token_types": [
      "urn:ietf:params:oauth:token-type:jwt-bearer"
    ]
  },
  {
    "audience": "https://api.example.com",
    "scope": "analytics.read",
    "supported_token_types": [
      "urn:ietf:params:oauth:token-type:jwt-bearer"
    ]
  },
  {
    "resource": ["https://api.example.com/reports"],
    "scope": "reports.read",
    "supported_token_types": [
      "urn:ietf:params:oauth:token-type:jwt-bearer"
    ]
  }
]

3.3.  Error Response

   If the request failed, the authorization server returns an error
   response as defined in Section 5.2 of [RFC6749].  The response MUST
   use the application/json media type, and the Content-Type header MUST
   be set to application/json.  The following error codes may be
   returned:

   invalid_request  The request is missing a required parameter,
      includes an invalid parameter value, includes a parameter more
      than once, or is otherwise malformed.  This error code is also
      returned when the provided subject token is invalid, expired,
      revoked, or does not match the subject token type, or when another
      error condition occurred during token validation.

   invalid_client  Client authentication failed (e.g., unknown client,
      no client authentication included, or unsupported authentication
      method).

   unauthorized_client  The authenticated client is not authorized to
      use this discovery endpoint.

   unsupported_token_type  The authorization server does not support the
      subject token type indicated by the subject_token_type parameter.

   server_error  The authorization server encountered an unexpected
      condition that prevented it from fulfilling the request.

   temporarily_unavailable  The authorization server is currently unable
      to handle the request due to a temporary overloading or
      maintenance of the server.

3.3.1.  Error Response Example

   The following is an example of an error response:

   HTTP/1.1 400 Bad Request
   Content-Type: application/json

   {
     "error": "invalid_request",
     "error_description": "The subject token is invalid or expired"
   }

4.  Example

   This example demonstrates a complete cross-domain identity chaining
   workflow using the token exchange target service discovery endpoint.

4.1.  Step 1: Discover Target Services

   The client begins with a subject access token issued by Domain A and
   calls the target service discovery endpoint to learn which target
   services are available.

4.1.1.  Discovery Request

POST https://as.domainA.example/target-discovery HTTP/1.1
Host: as.domainA.example
Content-Type: application/x-www-form-urlencoded

client_id=client-A
&client_assertion_type=urn:ietf:params:oauth:client-assertion-type:jwt-bearer
&client_assertion=eyJhbGciOi...
&subject_token=SlAV32hkKG...ACCESSTOKEN...
&subject_token_type=urn:ietf:params:oauth:token-type:access_token

4.1.2.  Discovery Response

HTTP/1.1 200 OK
Content-Type: application/json

[
  {
    "audience": "https://api.domainB.example",
    "resource": ["https://api.domainB.example/orders", "https://api.domainB.example/inventory"],
    "scope": "orders.read inventory.read",
    "supported_token_types": [
      "urn:ietf:params:oauth:token-type:jwt-bearer"
    ]
  }
]

   From this response, the client learns that it may request a token
   exchange for the audience https://api.domainB.example with the
   resources https://api.domainB.example/orders and
   https://api.domainB.example/inventory and the scopes orders.read and
   inventory.read.  The client also learns that JWT bearer tokens are
   supported for this target service.

4.2.  Step 2: Discover Token Types (Optional)

   If the discovery response does not include supported_token_types, or
   if the client needs to verify token type support, the client may
   query the Authorization Server Metadata of Domain B to determine
   which token types are supported for the target service.

4.2.1.  Metadata Request

GET https://as.domainB.example/.well-known/oauth-authorization-server HTTP/1.1
Host: as.domainB.example

4.2.2.  Metadata Response

   HTTP/1.1 200 OK
   Content-Type: application/json

   {
     "issuer": "https://as.domainB.example",
     "token_endpoint": "https://as.domainB.example/token",
     "requested_token_types_supported": [
       "urn:ietf:params:oauth:token-type:jwt-bearer"
     ]
   }

   This confirms that Domain B supports JWT bearer tokens as a requested
   token type.

4.3.  Step 3: Perform Token Exchange

   The client now performs a token exchange with Domain A's token
   endpoint, requesting a JWT for Domain B using the values discovered
   in the previous steps.

4.3.1.  Token Exchange Request

   POST https://as.domainA.example/token HTTP/1.1
   Host: as.domainA.example
   Content-Type: application/x-www-form-urlencoded

   grant_type=urn:ietf:params:oauth:grant-type:token-exchange
   &subject_token=SlAV32hkKG...ACCESSTOKEN...
   &subject_token_type=urn:ietf:params:oauth:token-type:access_token
   &requested_token_type=urn:ietf:params:oauth:token-type:jwt-bearer
   &audience=https://api.domainB.example
   &resource=https://api.domainB.example/orders
   &resource=https://api.domainB.example/inventory
   &scope=orders.read inventory.read

4.3.2.  Token Exchange Response

   HTTP/1.1 200 OK
   Content-Type: application/json

   {
     "access_token": "eyJraWQiOi...DOMAINB.JWT...",
     "issued_token_type": "urn:ietf:params:oauth:token-type:jwt-bearer",
     "token_type": "N_A",
     "expires_in": 3600,
     "scope": "orders.read inventory.read"
   }

   The client now holds a Domain B-scoped JWT token that can be used to
   access the target service, derived from Domain A's access token
   through the token exchange process.

5.  Authorization Server Metadata

   This specification defines the following authorization server
   metadata [RFC8414] parameter to enable clients to discover the token
   exchange target service discovery endpoint:

   token_exchange_target_service_discovery_endpoint  URL of the token
      exchange target service discovery endpoint.  This URL MUST use the
      https scheme.  The authorization server SHOULD publish this
      metadata value.

   The following is a non-normative example of the metadata:

{
  "issuer": "https://as.example.com",
  "token_exchange_target_service_discovery_endpoint": "https://as.example.com/target-discovery"
}

6.  Security Considerations

6.1.  Subject Token Validation

   The authorization server MUST validate the subject token provided in
   the request.  The validation process MUST verify that:

   *  The subject token is valid and not expired

   *  The subject token type matches the subject_token_type parameter

   *  The subject token is associated with the authenticated client (if
      client authentication is required)

   *  The subject token has not been revoked

   If any validation fails, the authorization server MUST return an
   invalid_request error as described in Section 2.2.

6.2.  Client Authentication

   The authorization server SHOULD require client authentication for the
   discovery endpoint to prevent unauthorized access to authorization
   information.  The authorization server MUST support at least one of
   the client authentication methods defined in Section 2.3 of
   [RFC6749].

6.3.  Authorization Policy Enforcement

   The authorization server MUST evaluate both the subject token and the
   client's permissions when determining which target services to
   return.  The server MUST only return target services that the client
   is authorized to request in a subsequent token exchange operation.

6.4.  Information Disclosure

   The discovery endpoint reveals information about which target
   services are available for a given subject token and client.  This
   information could be used by an attacker to enumerate authorization
   relationships.  To mitigate this risk:

   *  The authorization server SHOULD require client authentication

   *  The authorization server SHOULD apply rate limiting to prevent
      enumeration attacks

   *  The authorization server MAY return different results based on the
      authenticated client to limit information disclosure

   *  The authorization server SHOULD log access to the discovery
      endpoint for security monitoring

6.5.  Token Confidentiality

   The subject token is transmitted in the request.  The authorization
   server MUST require the use of TLS as specified in Section 1.6 of
   [RFC6749] to protect the token in transit.

6.6.  Error Handling

   The authorization server MUST NOT provide detailed error messages
   that could aid an attacker in understanding the authorization
   server's internal state or policies.  Error responses SHOULD be
   generic and not reveal specific information about why a request
   failed beyond what is necessary for the client to correct the
   request.

7.  Privacy Considerations

   The discovery endpoint returns information about authorization
   relationships between subjects, clients, and target services.  This
   information may be considered privacy-sensitive, as it reveals:

   *  Which target services a subject is authorized to access

   *  The scope of permissions available for each target service

   *  The existence of authorization relationships

   To protect privacy:

   *  The authorization server SHOULD only return information that the
      authenticated client is authorized to know

   *  The authorization server SHOULD apply the principle of least
      privilege when determining which target services to return

   *  The authorization server SHOULD log access to the discovery
      endpoint in accordance with applicable privacy regulations

   *  The authorization server MAY provide mechanisms for subjects to
      control or limit the information returned by the discovery
      endpoint

8.  IANA Considerations

8.1.  OAuth Authorization Server Metadata Registry

   This specification registers the following value in the IANA "OAuth
   Authorization Server Metadata" registry [RFC8414] established by
   [RFC8414].

   Metadata Name: token_exchange_target_service_discovery_endpoint

   Metadata Description: URL of the token exchange target service
   discovery endpoint

   Change Controller: IESG

   Specification Document(s): [[ this document ]]

9.  Normative References

   [RFC6749]  Hardt, D., Ed., "The OAuth 2.0 Authorization Framework",
              RFC 6749, DOI 10.17487/RFC6749, October 2012,
              <https://www.rfc-editor.org/info/rfc6749>.

   [RFC7159]  Bray, T., Ed., "The JavaScript Object Notation (JSON) Data
              Interchange Format", RFC 7159, DOI 10.17487/RFC7159, March
              2014, <https://www.rfc-editor.org/info/rfc7159>.

   [RFC8707]  Campbell, B., Bradley, J., and H. Tschofenig, "Resource
              Indicators for OAuth 2.0", RFC 8707, DOI 10.17487/RFC8707,
              February 2020, <https://www.rfc-editor.org/info/rfc8707>.

   [RFC8414]  Jones, M., Sakimura, N., and J. Bradley, "OAuth 2.0
              Authorization Server Metadata", RFC 8414,
              DOI 10.17487/RFC8414, June 2018,
              <https://www.rfc-editor.org/info/rfc8414>.

   [RFC3986]  Berners-Lee, T., Fielding, R., and L. Masinter, "Uniform
              Resource Identifier (URI): Generic Syntax", STD 66,
              RFC 3986, DOI 10.17487/RFC3986, January 2005,
              <https://www.rfc-editor.org/info/rfc3986>.

   [RFC8693]  Jones, M., Nadalin, A., Campbell, B., Ed., Bradley, J.,
              and C. Mortimore, "OAuth 2.0 Token Exchange", RFC 8693,
              DOI 10.17487/RFC8693, January 2020,
              <https://www.rfc-editor.org/info/rfc8693>.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/info/rfc2119>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
              May 2017, <https://www.rfc-editor.org/info/rfc8174>.

Acknowledgments

   TODO acknowledge.

Authors' Addresses

   Karl McGuinness
   Independent
   Email: public@karlmcguinness.com


   Aaron Parecki
   Okta
   Email: aaron@parecki.com
   URI:   https://www.okta.com
